<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>lsystem.py</title><link type="text/css" rel="stylesheet" href="pycol.css" /></head><pre><span class="String">'''
Bernie's L System demo in Python.

This program implements a simple context free L System,
and renders two dimensional images in a window.
It needs (at least) python 2.6, and uses the turtle 
graphics library, which is based on TK graphics.

To try it out, either load into Python and run the 
demo functions, or run it from the command line:
  
   python lsystem.py

Author: Bernie Pope: www.cs.mu.oz.au/~bjpop/
Licence: unrestricted.

Feel free to play with the code as much as you like
and share your changes with the world.

Some remarks about the implementation:

An L-System is a term rewriting system made up of one or
more rules. Rules have the form:

   head -&gt; body

where head is a variable, and body is a non-empty string
made up of variables and constants. Variables are 
denoted by upper-case alphabetic letters. Constants
are denoted by any character which is not a variable.

Here is an example L-System: 

   X -&gt; F-[[X]+X]+F[+FX]-X
   F -&gt; FF

In this program the convention is that the first rule
is taken as the starting point.

An LSystem object is constructed like so:

   rules = ['X -&gt; F-[[X]+X]+F[+FX]-X', 'F -&gt; FF'] 
   my_system = LSystem(rules)

That is, the LSystem constructor takes a list of strings
as its argument, where each string is a single rule.

An LSystem object doesn't do anything on its own - it must
be interpreted.

LSystem objects have a run method which takes two parameters:
   1) An non-negative integer which indicates how many times
      the rules should be iterated. 
   2) An interpreter object which implements an 'interpretTokens' 
      method.

Here is a simple example:

  class SimpleInterp(object):
     def interpretTokens(self, tokens): return tokens

  answer = my_system().run(6, SimpleInterp())

A more sophisticated interpreter is defined called Visualise
which renders the result of iterating an LSystem as turtle
graphics.

The Visualise constructor takes a dictionary mapping LSystem
variables to functions, here is an example:

   { '-': lambda _ : left(left_angle)
   , '+': lambda _ : right(right_angle)
   , 'F': lambda _ : forward(fwd_distance)
   , '[': lambda obj : obj.push()
   , ']': lambda obj : obj.pop()
   }

'''</span>
<span class="Layout"></span>
<span class="Keyword">import</span> <span class="Identifier">sys</span>
<span class="Comment"># import the turtle graphics library</span><span class="Layout"></span>
<span class="Keyword">try</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">from</span> <span class="Identifier">turtle</span> <span class="Keyword">import</span> <span class="Operator">*</span><span class="Layout"></span>
<span class="Keyword">except</span> <span class="Identifier">ImportError</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">print</span><span class="Bracket">(</span><span class="String">&quot;This program requires the turtle graphics library.&quot;</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">print</span><span class="Bracket">(</span><span class="String">&quot;Unfortunately Python cannot find that library on your computer.&quot;</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">print</span><span class="Bracket">(</span><span class="String">&quot;See the documentation at: http://docs.python.org/library/turtle.html&quot;</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">sys</span><span class="Operator">.</span><span class="Identifier">exit</span><span class="Bracket">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Bracket">)</span><span class="Layout"></span>
<span class="Keyword">from</span> <span class="Identifier">collections</span> <span class="Keyword">import</span> <span class="Identifier">deque</span>
<span class="Layout"></span>
<span class="Identifier">py_version</span> <span class="Assignment">=</span> <span class="Identifier">sys</span><span class="Operator">.</span><span class="Identifier">version_info</span><span class="Bracket">[</span><span class="Punctuation">:</span><span class="Number">2</span><span class="Bracket">]</span><span class="Layout"></span>
<span class="Keyword">if</span> <span class="Identifier">py_version</span> <span class="Operator">&lt;</span> <span class="Bracket">(</span><span class="Number">2</span><span class="Punctuation">,</span><span class="Number">6</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">print</span><span class="Bracket">(</span><span class="String">&quot;This program requires Python version 2.6 or greater to run.&quot;</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">print</span><span class="Bracket">(</span><span class="String">&quot;Your version of Python is &quot;</span> <span class="Operator">+</span> <span class="String">'.'</span><span class="Operator">.</span><span class="Identifier">join</span><span class="Bracket">(</span><span class="Identifier">map</span><span class="Bracket">(</span><span class="Identifier">str</span><span class="Punctuation">,</span><span class="Identifier">py_version</span><span class="Bracket">)</span><span class="Bracket">)</span> <span class="Operator">+</span> <span class="String">&quot;, which is too old.&quot;</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">sys</span><span class="Operator">.</span><span class="Identifier">exit</span><span class="Bracket">(</span><span class="Operator">-</span><span class="Number">1</span><span class="Bracket">)</span>

<span class="Comment"># Some demo functions, which make it relatively easy to use</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">interactive_demo</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">action</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Keyword">print</span><span class="Bracket">(</span><span class="Identifier">name</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">action</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">input</span> <span class="Assignment">=</span> <span class="Identifier">raw_input</span><span class="Bracket">(</span><span class="String">&quot;Press any key to continue or q/Q to quit: &quot;</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Keyword">if</span> <span class="Identifier">input</span><span class="Operator">.</span><span class="Identifier">lower</span><span class="Bracket">(</span><span class="Bracket">)</span> <span class="Operator">==</span> <span class="String">'q'</span><span class="Punctuation">:</span>
         <span class="Layout"></span><span class="Identifier">sys</span><span class="Operator">.</span><span class="Identifier">exit</span><span class="Bracket">(</span><span class="Number">0</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Bushy tree&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo1</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Twiggy tree&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo2</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Koch curve&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo3</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Sierpinski triangle&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo4</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Peano Gosper curve&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo5</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Conifer-like tree&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo6</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Tiles&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo7</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Crystal&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo8</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">show_demo</span><span class="Bracket">(</span><span class="String">&quot;Peano curve&quot;</span><span class="Punctuation">,</span> <span class="Identifier">demo9</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo0</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">class</span> <span class="Identifier">SimpleInterp</span><span class="Bracket">(</span><span class="Identifier">object</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">interpretTokens</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Punctuation">,</span> <span class="Identifier">tokens</span><span class="Bracket">)</span><span class="Punctuation">:</span> <span class="Keyword">return</span> <span class="Identifier">tokens</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Identifier">bushy_tree</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">6</span><span class="Punctuation">,</span> <span class="Identifier">SimpleInterp</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo1</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">left</span><span class="Bracket">(</span><span class="Number">90</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">25</span><span class="Punctuation">,</span><span class="Number">25</span><span class="Punctuation">,</span><span class="Number">5</span><span class="Bracket">)</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">bushy_tree</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">5</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">bushy_tree</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
    <span class="Layout"></span><span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Bracket">[</span><span class="String">'F -&gt; FF-[-F+F+F]+[+F-F-F]'</span><span class="Bracket">]</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo2</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">left</span><span class="Bracket">(</span><span class="Number">90</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">25</span><span class="Punctuation">,</span><span class="Number">25</span><span class="Punctuation">,</span><span class="Number">2</span><span class="Bracket">)</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">twiggy_tree</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">7</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">twiggy_tree</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
    <span class="Layout"></span><span class="Identifier">rules</span> <span class="Assignment">=</span> <span class="Bracket">[</span><span class="String">'X -&gt; F-[[X]+X]+F[+FX]-X'</span><span class="Punctuation">,</span> <span class="String">'F -&gt; FF'</span><span class="Bracket">]</span> <span class="Layout"></span>
    <span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo3</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span> <span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Operator">-</span><span class="Number">9</span><span class="Operator">*</span><span class="Identifier">width</span><span class="Operator">/</span><span class="Number">20</span><span class="Punctuation">,</span> <span class="Operator">-</span><span class="Identifier">height</span><span class="Operator">/</span><span class="Number">4</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Identifier">None</span><span class="Punctuation">,</span><span class="Identifier">None</span><span class="Punctuation">,</span><span class="Number">0.06</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span><span class="Bracket">[</span><span class="String">'-'</span><span class="Bracket">]</span> <span class="Assignment">=</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">right</span><span class="Bracket">(</span><span class="Number">68</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span><span class="Bracket">[</span><span class="String">'+'</span><span class="Bracket">]</span> <span class="Assignment">=</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">left</span><span class="Bracket">(</span><span class="Number">68</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">actions</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">koch</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">7</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">koch</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
    <span class="Layout"></span><span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Bracket">[</span><span class="String">'F -&gt; F+F-F-F+F'</span><span class="Bracket">]</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo4</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Operator">-</span><span class="Number">3</span><span class="Operator">*</span><span class="Identifier">width</span><span class="Operator">/</span><span class="Number">8</span><span class="Punctuation">,</span> <span class="Operator">-</span><span class="Identifier">height</span><span class="Operator">/</span><span class="Number">4</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">60</span><span class="Punctuation">,</span><span class="Number">60</span><span class="Punctuation">,</span><span class="Number">0</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span><span class="Bracket">[</span><span class="String">'A'</span><span class="Bracket">]</span> <span class="Assignment">=</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">forward</span><span class="Bracket">(</span><span class="Number">0.5</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span><span class="Bracket">[</span><span class="String">'B'</span><span class="Bracket">]</span> <span class="Assignment">=</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">forward</span><span class="Bracket">(</span><span class="Number">0.5</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span><span class="Bracket">[</span><span class="String">'-'</span><span class="Bracket">]</span> <span class="Assignment">=</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">right</span><span class="Bracket">(</span><span class="Number">60</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span><span class="Bracket">[</span><span class="String">'+'</span><span class="Bracket">]</span> <span class="Assignment">=</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">left</span><span class="Bracket">(</span><span class="Number">60</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">actions</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">sierpinski</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">10</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">sierpinski</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Bracket">[</span><span class="String">'A -&gt; B-A-B'</span><span class="Punctuation">,</span> <span class="String">'B -&gt; A+B+A'</span><span class="Bracket">]</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo5</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Identifier">width</span><span class="Operator">/</span><span class="Number">4</span><span class="Punctuation">,</span> <span class="Number">3</span><span class="Operator">*</span><span class="Identifier">height</span><span class="Operator">/</span><span class="Number">8</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">60</span><span class="Punctuation">,</span><span class="Number">60</span><span class="Punctuation">,</span><span class="Number">4</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">actions</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">peano_gosper</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">5</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">peano_gosper</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">rules</span> <span class="Assignment">=</span> <span class="Bracket">[</span> <span class="String">'X -&gt; X+YF++YF-FX--FXFX-YF+'</span>
           <span class="Punctuation">,</span> <span class="String">'Y -&gt; -FX+YFYF++YF+FX--FX-Y'</span>
           <span class="Punctuation">,</span> <span class="String">'F -&gt; F'</span> <span class="Bracket">]</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo6</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Number">0</span><span class="Punctuation">,</span> <span class="Operator">-</span><span class="Number">3</span><span class="Operator">*</span><span class="Identifier">height</span><span class="Operator">/</span><span class="Number">8</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">left</span><span class="Bracket">(</span><span class="Number">90</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">20</span><span class="Punctuation">,</span><span class="Number">20</span><span class="Punctuation">,</span><span class="Number">11</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">actions</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">conifer</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">12</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">conifer</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">rules</span> <span class="Assignment">=</span> <span class="Bracket">[</span> <span class="String">'I -&gt; VZFFF'</span>
           <span class="Punctuation">,</span> <span class="String">'V -&gt; [+++W][---W]YV'</span>
           <span class="Punctuation">,</span> <span class="String">'W -&gt; +X[-W]Z'</span>
           <span class="Punctuation">,</span> <span class="String">'X -&gt; -W[+X]Z'</span>
           <span class="Punctuation">,</span> <span class="String">'Y -&gt; YZ'</span>
           <span class="Punctuation">,</span> <span class="String">'Z -&gt; [-FFF][+FFF]F'</span>
           <span class="Punctuation">,</span> <span class="String">'F -&gt; F'</span> <span class="Bracket">]</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo7</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Operator">-</span><span class="Identifier">width</span><span class="Operator">/</span><span class="Number">5</span><span class="Punctuation">,</span> <span class="Number">0</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">90</span><span class="Punctuation">,</span><span class="Number">90</span><span class="Punctuation">,</span><span class="Number">4</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">actions</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">tiles</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">6</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">tiles</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">rules</span> <span class="Assignment">=</span> <span class="Bracket">[</span> <span class="String">'I -&gt; F+F+F+F'</span>
           <span class="Punctuation">,</span> <span class="String">'F -&gt; FF+F-F+F+FF'</span> <span class="Bracket">]</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo8</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Operator">-</span><span class="Identifier">width</span><span class="Operator">/</span><span class="Number">3</span><span class="Punctuation">,</span> <span class="Operator">-</span><span class="Identifier">height</span><span class="Operator">/</span><span class="Number">3</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">left</span><span class="Bracket">(</span><span class="Number">90</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">90</span><span class="Punctuation">,</span><span class="Number">90</span><span class="Punctuation">,</span><span class="Number">2</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">actions</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">crystal</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">6</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">crystal</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">rules</span> <span class="Assignment">=</span> <span class="Bracket">[</span><span class="String">'I -&gt; F+F+F+F'</span><span class="Punctuation">,</span> <span class="String">'F -&gt; FF+F++F+F'</span><span class="Bracket">]</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">demo9</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">init</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Operator">-</span><span class="Identifier">width</span><span class="Operator">/</span><span class="Number">3</span><span class="Punctuation">,</span> <span class="Operator">-</span><span class="Identifier">height</span><span class="Operator">/</span><span class="Number">3</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">left</span><span class="Bracket">(</span><span class="Number">90</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">basic_actions</span><span class="Bracket">(</span><span class="Number">90</span><span class="Punctuation">,</span><span class="Number">90</span><span class="Punctuation">,</span><span class="Number">2</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">vis</span> <span class="Assignment">=</span> <span class="Identifier">Visualise</span><span class="Bracket">(</span><span class="Identifier">actions</span><span class="Punctuation">,</span> <span class="Identifier">init</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">peano_curve</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">.</span><span class="Identifier">run</span><span class="Bracket">(</span><span class="Number">5</span><span class="Punctuation">,</span><span class="Identifier">vis</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">peano_curve</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">rules</span> <span class="Assignment">=</span> <span class="Bracket">[</span> <span class="String">'X -&gt; XFYFX+F+YFXFY-F-XFYFX'</span>
           <span class="Punctuation">,</span> <span class="String">'Y -&gt; YFXFY-F-XFYFX+F+YFXFY'</span>
           <span class="Punctuation">,</span> <span class="String">'F -&gt; F'</span> <span class="Bracket">]</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">class</span> <span class="Identifier">LSystem</span><span class="Bracket">(</span><span class="Identifier">object</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">__init__</span> <span class="Bracket">(</span><span class="Identifier">self</span><span class="Punctuation">,</span> <span class="Identifier">rules</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Keyword">if</span> <span class="Identifier">len</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">)</span> <span class="Operator">&gt;</span> <span class="Number">0</span><span class="Punctuation">:</span>
         <span class="Layout"></span><span class="Keyword">for</span> <span class="Identifier">r</span> <span class="Keyword">in</span> <span class="Identifier">rules</span><span class="Punctuation">:</span>
            <span class="Layout"></span><span class="Keyword">exec</span><span class="Bracket">(</span><span class="Identifier">compile</span><span class="Bracket">(</span><span class="Identifier">r</span><span class="Bracket">)</span><span class="Bracket">)</span> <span class="Keyword">in</span> <span class="Identifier">locals</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
         <span class="Identifier">firstRuleName</span><span class="Punctuation">,</span><span class="Identifier">_</span> <span class="Assignment">=</span> <span class="Identifier">decomposeRule</span><span class="Bracket">(</span><span class="Identifier">rules</span><span class="Bracket">[</span><span class="Number">0</span><span class="Bracket">]</span><span class="Bracket">)</span><span class="Layout"></span>
         <span class="Keyword">exec</span><span class="Bracket">(</span><span class="String">'def start(n): return '</span> <span class="Operator">+</span> <span class="Identifier">firstRuleName</span> <span class="Operator">+</span> <span class="String">'(n)'</span><span class="Bracket">)</span> <span class="Keyword">in</span> <span class="Identifier">locals</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
         <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">rule</span> <span class="Assignment">=</span> <span class="Identifier">start</span><span class="Layout"></span>
      <span class="Keyword">else</span><span class="Punctuation">:</span>
         <span class="Layout"></span><span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">rule</span> <span class="Assignment">=</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="String">''</span><span class="Layout"></span>
   <span class="Keyword">def</span> <span class="Identifier">run</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Punctuation">,</span> <span class="Identifier">maxIterations</span><span class="Punctuation">,</span> <span class="Identifier">interpreter</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Keyword">return</span> <span class="Identifier">interpreter</span><span class="Operator">.</span><span class="Identifier">interpretTokens</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">rule</span><span class="Bracket">(</span><span class="Identifier">maxIterations</span><span class="Bracket">)</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">class</span> <span class="Identifier">Visualise</span> <span class="Bracket">(</span><span class="Identifier">object</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">def</span> <span class="Identifier">__init__</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Punctuation">,</span> <span class="Identifier">dict</span><span class="Punctuation">,</span> <span class="Identifier">initCommand</span><span class="Assignment">=</span><span class="Identifier">None</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">actions</span> <span class="Assignment">=</span> <span class="Identifier">dict</span><span class="Layout"></span>
      <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">initCommand</span> <span class="Assignment">=</span> <span class="Identifier">initCommand</span><span class="Layout"></span>
      <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">stack</span> <span class="Assignment">=</span> <span class="Identifier">deque</span><span class="Bracket">(</span><span class="Bracket">)</span>
<span class="Layout"></span>
   <span class="Keyword">def</span> <span class="Identifier">interpretTokens</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Punctuation">,</span> <span class="Identifier">tokens</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">initDisplay</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Keyword">if</span> <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">initCommand</span> <span class="Operator">!=</span> <span class="Identifier">None</span><span class="Punctuation">:</span> <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">initCommand</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Keyword">def</span> <span class="Identifier">action_fun</span><span class="Bracket">(</span><span class="Identifier">token</span><span class="Bracket">)</span><span class="Punctuation">:</span>
         <span class="Layout"></span><span class="Keyword">return</span> <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">actions</span><span class="Operator">.</span><span class="Identifier">get</span><span class="Bracket">(</span><span class="Identifier">token</span><span class="Punctuation">,</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">None</span><span class="Bracket">)</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">stack</span> <span class="Assignment">=</span> <span class="Identifier">deque</span><span class="Bracket">(</span><span class="Bracket">)</span> <span class="Layout"></span>
      <span class="Identifier">map</span> <span class="Bracket">(</span><span class="Identifier">action_fun</span><span class="Punctuation">,</span> <span class="Identifier">tokens</span><span class="Bracket">)</span>
<span class="Layout"></span>
   <span class="Keyword">def</span> <span class="Identifier">push</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">orient</span> <span class="Assignment">=</span> <span class="Identifier">heading</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">pos</span> <span class="Assignment">=</span> <span class="Identifier">position</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">stack</span><span class="Operator">.</span><span class="Identifier">append</span><span class="Bracket">(</span><span class="Bracket">(</span><span class="Identifier">orient</span><span class="Punctuation">,</span> <span class="Identifier">pos</span><span class="Bracket">)</span><span class="Bracket">)</span>
<span class="Layout"></span>
   <span class="Keyword">def</span> <span class="Identifier">pop</span><span class="Bracket">(</span><span class="Identifier">self</span><span class="Bracket">)</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Identifier">stack</span> <span class="Assignment">=</span> <span class="Identifier">self</span><span class="Operator">.</span><span class="Identifier">stack</span><span class="Layout"></span>
      <span class="Keyword">if</span> <span class="Identifier">len</span><span class="Bracket">(</span><span class="Identifier">stack</span><span class="Bracket">)</span> <span class="Operator">==</span> <span class="Number">0</span><span class="Punctuation">:</span>
         <span class="Layout"></span><span class="Keyword">raise</span> <span class="Identifier">Exception</span><span class="Bracket">(</span><span class="String">'Attempt to pop empty stack'</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Bracket">(</span><span class="Identifier">orient</span><span class="Punctuation">,</span> <span class="Identifier">pos</span><span class="Bracket">)</span> <span class="Assignment">=</span> <span class="Identifier">stack</span><span class="Operator">.</span><span class="Identifier">pop</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">up</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">goto</span><span class="Bracket">(</span><span class="Identifier">pos</span><span class="Bracket">)</span> <span class="Layout"></span>
      <span class="Identifier">setheading</span><span class="Bracket">(</span><span class="Identifier">orient</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Identifier">down</span><span class="Bracket">(</span><span class="Bracket">)</span>
      <span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">basic_actions</span> <span class="Bracket">(</span><span class="Identifier">left_angle</span><span class="Punctuation">,</span> <span class="Identifier">right_angle</span><span class="Punctuation">,</span> <span class="Identifier">fwd_distance</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">return</span> <span class="Bracket">{</span> <span class="String">'-'</span><span class="Punctuation">:</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">left</span><span class="Bracket">(</span><span class="Identifier">left_angle</span><span class="Bracket">)</span>
          <span class="Punctuation">,</span> <span class="String">'+'</span><span class="Punctuation">:</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">right</span><span class="Bracket">(</span><span class="Identifier">right_angle</span><span class="Bracket">)</span>
          <span class="Punctuation">,</span> <span class="String">'F'</span><span class="Punctuation">:</span> <span class="Keyword">lambda</span> <span class="Identifier">_</span> <span class="Punctuation">:</span> <span class="Identifier">forward</span><span class="Bracket">(</span><span class="Identifier">fwd_distance</span><span class="Bracket">)</span>
          <span class="Punctuation">,</span> <span class="String">'['</span><span class="Punctuation">:</span> <span class="Keyword">lambda</span> <span class="Identifier">obj</span> <span class="Punctuation">:</span> <span class="Identifier">obj</span><span class="Operator">.</span><span class="Identifier">push</span><span class="Bracket">(</span><span class="Bracket">)</span>
          <span class="Punctuation">,</span> <span class="String">']'</span><span class="Punctuation">:</span> <span class="Keyword">lambda</span> <span class="Identifier">obj</span> <span class="Punctuation">:</span> <span class="Identifier">obj</span><span class="Operator">.</span><span class="Identifier">pop</span><span class="Bracket">(</span><span class="Bracket">)</span>
          <span class="Bracket">}</span>

<span class="Comment"># Configuration of graphics window</span><span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">initDisplay</span><span class="Bracket">(</span><span class="Identifier">drawColour</span><span class="Assignment">=</span><span class="String">&quot;black&quot;</span><span class="Bracket">)</span><span class="Punctuation">:</span>
    <span class="Layout"></span><span class="Identifier">title</span> <span class="Bracket">(</span><span class="String">&quot;Bernie's L System demo&quot;</span><span class="Bracket">)</span><span class="Layout"></span>
    <span class="Identifier">setup</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
    <span class="Identifier">reset</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
    <span class="Identifier">degrees</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
    <span class="Identifier">color</span><span class="Bracket">(</span><span class="Identifier">drawColour</span><span class="Bracket">)</span>
    <span class="Comment"># Try to make the animation of drawing reasonably fast.</span><span class="Layout"></span>
    <span class="Identifier">tracer</span><span class="Bracket">(</span><span class="Number">50</span><span class="Punctuation">,</span><span class="Number">0</span><span class="Bracket">)</span> <span class="Comment"># Only draw every 50th update, set delay to zero.</span><span class="Layout"></span>
    <span class="Identifier">hideturtle</span><span class="Bracket">(</span><span class="Bracket">)</span> <span class="Comment"># don't draw the turtle; increase drawing speed.</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">initPosition</span><span class="Bracket">(</span><span class="Identifier">mover</span><span class="Assignment">=</span><span class="Keyword">lambda</span> <span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span> <span class="Punctuation">:</span> <span class="Bracket">(</span><span class="Number">0</span><span class="Punctuation">,</span> <span class="Operator">-</span><span class="Identifier">height</span><span class="Operator">/</span><span class="Number">2</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">height</span> <span class="Assignment">=</span> <span class="Identifier">window_height</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">width</span> <span class="Assignment">=</span> <span class="Identifier">window_width</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">up</span><span class="Bracket">(</span><span class="Bracket">)</span> <span class="Layout"></span>
   <span class="Identifier">goto</span> <span class="Bracket">(</span><span class="Identifier">mover</span> <span class="Bracket">(</span><span class="Identifier">width</span><span class="Punctuation">,</span> <span class="Identifier">height</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">down</span><span class="Bracket">(</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="String">'''
The input rule:
 
   X -&gt; X+X+F

is compiled to:

   def X(n): 
       if n &gt; 0:
          xn = X(n-1)
          fn = F(n-1)
          return ''.join([xn,'+',xn,'+',fn])
       else:
          return 'X'
'''</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">compile</span><span class="Bracket">(</span><span class="Identifier">rule</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Bracket">(</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">body</span><span class="Bracket">)</span> <span class="Assignment">=</span> <span class="Identifier">decomposeRule</span><span class="Bracket">(</span><span class="Identifier">rule</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Bracket">(</span><span class="Identifier">vars</span><span class="Punctuation">,</span><span class="Identifier">listIds</span><span class="Bracket">)</span> <span class="Assignment">=</span> <span class="Identifier">varsIds</span><span class="Bracket">(</span><span class="Identifier">body</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">defPart</span> <span class="Assignment">=</span> <span class="String">'def '</span> <span class="Operator">+</span> <span class="Identifier">name</span> <span class="Operator">+</span> <span class="String">'(n):'</span><span class="Layout"></span>
   <span class="Identifier">varBinds</span> <span class="Assignment">=</span> <span class="Identifier">list</span><span class="Bracket">(</span><span class="Identifier">map</span><span class="Bracket">(</span><span class="Identifier">mkVarBind</span><span class="Punctuation">,</span><span class="Identifier">vars</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">joinListPart</span> <span class="Assignment">=</span> <span class="String">&quot;''.join([&quot;</span> <span class="Operator">+</span> <span class="String">','</span><span class="Operator">.</span><span class="Identifier">join</span><span class="Bracket">(</span><span class="Identifier">listIds</span><span class="Bracket">)</span> <span class="Operator">+</span> <span class="String">'])'</span><span class="Layout"></span>
   <span class="Identifier">ifHead</span> <span class="Assignment">=</span> <span class="String">'if n &gt; 0:'</span> <span class="Layout"></span>
   <span class="Identifier">ifBody</span> <span class="Assignment">=</span> <span class="Identifier">varBinds</span> <span class="Operator">+</span> <span class="Bracket">[</span><span class="String">'return '</span> <span class="Operator">+</span> <span class="Identifier">joinListPart</span><span class="Bracket">]</span><span class="Layout"></span>
   <span class="Identifier">elsePart</span> <span class="Assignment">=</span> <span class="String">'else: return '</span> <span class="Operator">+</span> <span class="Identifier">quote</span><span class="Bracket">(</span><span class="Identifier">name</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="String">'\n'</span><span class="Operator">.</span><span class="Identifier">join</span><span class="Bracket">(</span>
      <span class="Bracket">[</span><span class="Identifier">defPart</span><span class="Bracket">]</span> <span class="Operator">+</span> <span class="Identifier">map</span><span class="Bracket">(</span><span class="Identifier">indent</span><span class="Punctuation">,</span>
         <span class="Bracket">[</span><span class="Identifier">ifHead</span><span class="Bracket">]</span> <span class="Operator">+</span> <span class="Identifier">map</span><span class="Bracket">(</span><span class="Identifier">indent</span><span class="Punctuation">,</span>
            <span class="Identifier">ifBody</span><span class="Bracket">)</span> <span class="Operator">+</span> <span class="Bracket">[</span><span class="Identifier">elsePart</span><span class="Bracket">]</span><span class="Bracket">)</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">decomposeRule</span><span class="Bracket">(</span><span class="Identifier">rule</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">splitRule</span> <span class="Assignment">=</span> <span class="Identifier">rule</span><span class="Operator">.</span><span class="Identifier">split</span><span class="Bracket">(</span><span class="String">'-&gt;'</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">if</span> <span class="Identifier">len</span><span class="Bracket">(</span><span class="Identifier">splitRule</span><span class="Bracket">)</span> <span class="Operator">!=</span> <span class="Number">2</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Keyword">raise</span> <span class="Identifier">Exception</span><span class="Bracket">(</span><span class="String">&quot;badly formed L-System rule: &quot;</span> <span class="Operator">+</span> <span class="Identifier">quote</span><span class="Bracket">(</span><span class="Identifier">str</span><span class="Bracket">(</span><span class="Identifier">rule</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">name</span> <span class="Assignment">=</span> <span class="Identifier">splitRule</span><span class="Bracket">[</span><span class="Number">0</span><span class="Bracket">]</span><span class="Operator">.</span><span class="Identifier">strip</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">body</span> <span class="Assignment">=</span> <span class="Identifier">splitRule</span><span class="Bracket">[</span><span class="Number">1</span><span class="Bracket">]</span><span class="Operator">.</span><span class="Identifier">strip</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">if</span> <span class="Identifier">len</span><span class="Bracket">(</span><span class="Identifier">name</span><span class="Bracket">)</span> <span class="Operator">!=</span> <span class="Number">1</span> <span class="Keyword">or</span> <span class="Identifier">len</span><span class="Bracket">(</span><span class="Identifier">body</span><span class="Bracket">)</span> <span class="Operator">==</span> <span class="Number">0</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Keyword">raise</span> <span class="Identifier">Exception</span><span class="Bracket">(</span><span class="String">&quot;badly formed L-System rule: &quot;</span> <span class="Operator">+</span> <span class="Identifier">quote</span><span class="Bracket">(</span><span class="Identifier">str</span><span class="Bracket">(</span><span class="Identifier">rule</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Bracket">(</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">body</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">mkVarBind</span><span class="Bracket">(</span><span class="Identifier">var</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Keyword">return</span> <span class="Identifier">var</span><span class="Operator">.</span><span class="Identifier">lower</span><span class="Bracket">(</span><span class="Bracket">)</span> <span class="Operator">+</span> <span class="String">'n = '</span> <span class="Operator">+</span> <span class="Identifier">var</span> <span class="Operator">+</span> <span class="String">'(n-1)'</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">quote</span><span class="Bracket">(</span><span class="Identifier">str</span><span class="Bracket">)</span><span class="Punctuation">:</span> <span class="Keyword">return</span> <span class="String">&quot;'&quot;</span> <span class="Operator">+</span> <span class="Identifier">str</span> <span class="Operator">+</span> <span class="String">&quot;'&quot;</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">indent</span><span class="Bracket">(</span><span class="Identifier">str</span><span class="Bracket">)</span><span class="Punctuation">:</span> <span class="Keyword">return</span> <span class="String">'   '</span> <span class="Operator">+</span> <span class="Identifier">str</span>
<span class="Layout"></span>
<span class="Keyword">def</span> <span class="Identifier">varsIds</span><span class="Bracket">(</span><span class="Identifier">str</span><span class="Bracket">)</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">vars</span> <span class="Assignment">=</span> <span class="Identifier">set</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Identifier">list</span> <span class="Assignment">=</span> <span class="Bracket">[</span><span class="Bracket">]</span><span class="Layout"></span>
   <span class="Keyword">for</span> <span class="Identifier">c</span> <span class="Keyword">in</span> <span class="Identifier">str</span><span class="Punctuation">:</span>
      <span class="Layout"></span><span class="Keyword">if</span> <span class="Identifier">c</span><span class="Operator">.</span><span class="Identifier">isupper</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Punctuation">:</span>
         <span class="Layout"></span><span class="Identifier">vars</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Bracket">(</span><span class="Identifier">c</span><span class="Bracket">)</span><span class="Layout"></span>
         <span class="Identifier">list</span><span class="Operator">.</span><span class="Identifier">append</span><span class="Bracket">(</span><span class="Identifier">c</span><span class="Operator">.</span><span class="Identifier">lower</span><span class="Bracket">(</span><span class="Bracket">)</span><span class="Operator">+</span><span class="String">'n'</span><span class="Bracket">)</span><span class="Layout"></span>
      <span class="Keyword">else</span><span class="Punctuation">:</span>
         <span class="Layout"></span><span class="Identifier">list</span><span class="Operator">.</span><span class="Identifier">append</span><span class="Bracket">(</span><span class="Identifier">quote</span><span class="Bracket">(</span><span class="Identifier">c</span><span class="Bracket">)</span><span class="Bracket">)</span><span class="Layout"></span>
   <span class="Keyword">return</span> <span class="Bracket">(</span><span class="Identifier">vars</span><span class="Punctuation">,</span> <span class="Identifier">list</span><span class="Bracket">)</span>
<span class="Layout"></span>
<span class="Keyword">if</span> <span class="Identifier">__name__</span> <span class="Operator">==</span> <span class="String">&quot;__main__&quot;</span><span class="Punctuation">:</span>
   <span class="Layout"></span><span class="Identifier">interactive_demo</span><span class="Bracket">(</span><span class="Bracket">)</span> <span class="Layout"></span></pre></html>
